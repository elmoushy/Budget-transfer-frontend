import{d as ve,u as pe,r as n,o as he,w as H,y as A,e as u,f as e,h as p,t as l,D as C,b as G,m as M,v as z,G as _e,F as fe,B as be,n as d,X as me,T as ge,p as Q,s as i,_ as ke}from"./index-Cre1HAju.js";import{T as N}from"./TransfersFlowService-DYo_P7oo.js";import{S as ye}from"./search-CJgeUnF8.js";import{E as Ce}from"./eye-ZqwV11c3.js";import{C as we}from"./check-DAKitar3.js";const je={class:"toolbar"},Re={class:"page-title"},Pe={class:"toolbar-right"},Se={class:"search-container"},Ae=["placeholder"],Me={key:0,class:"selection-bar"},Te={class:"selection-info"},qe={class:"action-buttons"},xe=["disabled"],De=["disabled"],$e={key:1,class:"loading-container"},Le={key:2,class:"table-container"},Be={key:"head"},Ee={class:"checkbox-column"},Ie={class:"checkbox-container"},Ve=["checked"],Fe={key:"body"},Ne={class:"checkbox-column"},Ue={class:"checkbox-container"},He=["onChange","checked"],Ge={class:"code-cell"},ze={class:"action-buttons-cell"},Qe=["onClick"],Xe=["onClick"],Je=["onClick"],Ke={key:"no-results"},Oe={colspan:"7",class:"no-results"},We={class:"pagination"},Ye=["disabled"],Ze={class:"page-info"},ea=["disabled"],aa={class:"modal-header"},ta={class:"modal-body"},sa={key:0,class:"reason-container"},oa={for:"rejection-reason",class:"reason-label"},la=["placeholder"],na={key:0,class:"reason-error"},ra={class:"modal-footer"},ca=["disabled"],ua={class:"modal-header"},ia={class:"modal-body"},da={class:"modal-footer"},X=10,va=ve({name:"SettlementsPendingApprovalPage",__name:"SettlementsPendingApproval",setup(pa){const w=pe(),s=n(!1),f=n(!1);he(()=>{s.value=w.language==="ar",f.value=w.darkMode,h()}),H(()=>w.language,t=>s.value=t==="ar"),H(()=>w.darkMode,t=>f.value=t);const J={stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"},K={stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},b=A(()=>s.value?K:J),T=n([]),q=n(0),x=n(!1),j=n(!1),D=n(""),R=n(!1);function O(t){return{pending:s.value?"قيد الانتظار":"Pending","under-review":s.value?"قيد المراجعة":"Under Review",approved:s.value?"تمت الموافقة":"Approved",rejected:s.value?"تم الرفض":"Rejected"}[t.toLowerCase()]||t}function W(t){try{const a=new Date(t);return new Intl.DateTimeFormat(s.value?"ar-SA":"en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(a)}catch{return t}}const r=n([]),Y=A(()=>k.value.length>0&&r.value.length===k.value.length);function $(t){return r.value.some(a=>a.transaction_id===t.transaction_id)}function Z(t){$(t)?r.value=r.value.filter(a=>a.transaction_id!==t.transaction_id):r.value.push(t)}function ee(t){t.target.checked?r.value=[...k.value]:r.value=[]}function ae(t){const a=t.toLowerCase();return a==="approved"?"row-approved":a==="rejected"?"row-rejected":a==="under-review"?"row-review":"row-pending"}const m=n(""),c=n(1),L=n(null);function te(){L.value&&clearTimeout(L.value),L.value=window.setTimeout(()=>{c.value=1,h()},500)}function se(){m.value="",c.value=1,h()}async function h(){try{x.value=!0;const t=await N.fetchPendingTransfers(c.value,X,m.value,"AFR");T.value=(t.results||[]).map(a=>({transaction_id:a.id||a.transaction_id,status:a.status,code:a.transfer_id||a.code||"",request_date:a.created_at||a.request_date||"",requested_by:a.user_name||a.requested_by||"",transaction_date:a.updated_at||a.transaction_date||""})),q.value=t.count||0,r.value=[]}catch(t){console.error("Failed to load transfers:",t),D.value=s.value?"حدث خطأ أثناء تحميل البيانات. يرجى المحاولة مرة أخرى.":"An error occurred while loading data. Please try again.",R.value=!0,T.value=[],q.value=0}finally{x.value=!1}}function oe(){c.value<g.value&&(c.value++,h())}function le(){c.value>1&&(c.value--,h())}const g=A(()=>Math.ceil(q.value/X)),k=A(()=>T.value);function ne(t){console.log("View details for row:",t.transaction_id)}function re(t){P("approve",[t])}function ce(t){P("reject",[t])}function ue(){P("approve",r.value)}function ie(){P("reject",r.value)}const B=n(!1),_=n("approve"),E=n(""),I=n(""),U=n([]),y=n(""),V=n(!1);function P(t,a){_.value=t,U.value=a,y.value="",V.value=!1;const o=a.length;t==="approve"?(E.value=s.value?"تأكيد الموافقة":"Confirm Approval",I.value=s.value?`هل أنت متأكد من موافقتك على ${o} من المناقلات؟`:`Are you sure you want to approve ${o} transfer request${o===1?"":"s"}?`):(E.value=s.value?"تأكيد الرفض":"Confirm Rejection",I.value=s.value?`هل أنت متأكد من رفضك لـ ${o} من المناقلات؟`:`Are you sure you want to reject ${o} transfer request${o===1?"":"s"}?`),B.value=!0}async function de(){if(_.value==="reject"&&!y.value.trim()){V.value=!0;return}try{j.value=!0;const t=_.value,o=U.value.map(v=>v.transaction_id);if(t==="approve")await N.approveRejectTransfers(o,2);else{const v=o.map(()=>y.value.trim());await N.approveRejectTransfers(o,3,v)}await h(),S()}catch(t){console.error("Error processing action:",t),D.value=s.value?"حدث خطأ أثناء معالجة الإجراء. يرجى المحاولة مرة أخرى.":"An error occurred while processing your action. Please try again.",R.value=!0}finally{j.value=!1}}function S(){B.value=!1}function F(){R.value=!1}return(t,a)=>(i(),u("div",{class:d(["approval-page",{"dark-mode":f.value}])},[e("div",je,[e("h1",Re,l(s.value?"المناقلات قيد الاعتماد":"Transfers Pending Approval"),1),e("div",Pe,[e("div",Se,[C(M(ye),{class:"search-icon"}),G(e("input",{"onUpdate:modelValue":a[0]||(a[0]=o=>m.value=o),type:"search",placeholder:s.value?"بحث...":"Search...",class:"input-search",onInput:te},null,40,Ae),[[z,m.value]]),m.value?(i(),u("button",{key:0,onClick:se,class:"clear-search"},"×")):p("",!0)])])]),r.value.length>0?(i(),u("div",Me,[e("span",Te,l(s.value?`تم اختيار ${r.value.length} عنصر`:`${r.value.length} items selected`),1),e("div",qe,[e("button",{onClick:ie,class:"btn-reject",disabled:r.value.length===0},l(s.value?"رفض":"Reject"),9,xe),e("button",{onClick:ue,class:"btn-approve",disabled:r.value.length===0},l(s.value?"موافقة":"Approve"),9,De)])])):p("",!0),x.value?(i(),u("div",$e,[a[4]||(a[4]=e("div",{class:"loader"},null,-1)),e("p",null,l(s.value?"جاري التحميل...":"Loading..."),1)])):(i(),u("div",Le,[C(ge,{name:"table-fade",tag:"table",class:"main-table"},{default:_e(()=>[e("thead",Be,[e("tr",null,[e("th",Ee,[e("label",Ie,[e("input",{type:"checkbox",onChange:ee,checked:Y.value},null,40,Ve),a[5]||(a[5]=e("span",{class:"checkmark"},null,-1))])]),e("th",null,l(b.value.stateLevel),1),e("th",null,l(b.value.code),1),e("th",null,l(b.value.requestDate),1),e("th",null,l(b.value.requestedBy),1),e("th",null,l(b.value.transactionDate),1),e("th",null,l(s.value?"إجراءات":"Actions"),1)])]),e("tbody",Fe,[(i(!0),u(fe,null,be(k.value,o=>(i(),u("tr",{key:o.transaction_id,class:d([[ae(o.status),{"row-selected":$(o)}],"table-row"])},[e("td",Ne,[e("label",Ue,[e("input",{type:"checkbox",onChange:v=>Z(o),checked:$(o)},null,40,He),a[6]||(a[6]=e("span",{class:"checkmark"},null,-1))])]),e("td",null,[e("span",{class:d(["status-badge","status-"+o.status.toLowerCase()])},l(O(o.status)),3)]),e("td",Ge,l(o.code),1),e("td",null,l(W(o.request_date)),1),e("td",null,l(o.requested_by),1),e("td",null,l(o.transaction_date),1),e("td",null,[e("div",ze,[e("button",{class:"icon-btn view-btn",onClick:v=>ne(o),title:"View Details"},[C(M(Ce))],8,Qe),e("button",{class:"icon-btn approve-btn",onClick:v=>re(o),title:"Approve"},[C(M(we))],8,Xe),e("button",{class:"icon-btn reject-btn",onClick:v=>ce(o),title:"Reject"},[C(M(me))],8,Je)])])],2))),128)),k.value.length===0?(i(),u("tr",Ke,[e("td",Oe,l(s.value?"لا توجد نتائج":"No results found"),1)])):p("",!0)])]),_:1})])),e("div",We,[e("button",{onClick:le,class:d(["page-btn",{disabled:c.value===1}]),disabled:c.value===1},l(s.value?"السابق":"Previous"),11,Ye),e("span",Ze,l(s.value?`صفحة ${c.value} من ${g.value}`:`Page ${c.value} of ${g.value}`),1),e("button",{onClick:oe,class:d(["page-btn",{disabled:c.value>=g.value}]),disabled:c.value>=g.value},l(s.value?"التالي":"Next"),11,ea)]),B.value?(i(),u("div",{key:3,class:"modal-overlay",onClick:S},[e("div",{class:d(["modal-container",{"dark-mode":f.value}]),onClick:a[2]||(a[2]=Q(()=>{},["stop"]))},[e("div",aa,[e("h2",null,l(E.value),1),e("button",{class:"close-modal",onClick:S},"×")]),e("div",ta,[e("p",null,l(I.value),1),_.value==="reject"?(i(),u("div",sa,[e("label",oa,l(s.value?"سبب الرفض:":"Rejection Reason:"),1),G(e("textarea",{id:"rejection-reason","onUpdate:modelValue":a[1]||(a[1]=o=>y.value=o),placeholder:s.value?"يرجى ذكر سبب الرفض...":"Please provide a reason for rejection...",class:"reason-textarea",rows:"3"},null,8,la),[[z,y.value]]),V.value?(i(),u("p",na,l(s.value?"سبب الرفض مطلوب":"Rejection reason is required"),1)):p("",!0)])):p("",!0)]),e("div",ra,[e("button",{class:"btn-secondary",onClick:S},l(s.value?"إلغاء":"Cancel"),1),e("button",{class:d(_.value==="approve"?"btn-approve":"btn-reject"),onClick:de,disabled:j.value},l(j.value?s.value?"جاري المعالجة...":"Processing...":_.value==="approve"?s.value?"موافقة":"Approve":s.value?"رفض":"Reject"),11,ca)])],2)])):p("",!0),R.value?(i(),u("div",{key:4,class:"modal-overlay",onClick:F},[e("div",{class:d(["modal-container error-modal",{"dark-mode":f.value}]),onClick:a[3]||(a[3]=Q(()=>{},["stop"]))},[e("div",ua,[e("h2",null,l(s.value?"خطأ":"Error"),1),e("button",{class:"close-modal",onClick:F},"×")]),e("div",ia,[e("p",null,l(D.value),1)]),e("div",da,[e("button",{class:"btn-secondary",onClick:F},l(s.value?"إغلاق":"Close"),1)])],2)])):p("",!0)],2))}}),ga=ke(va,[["__scopeId","data-v-9277086c"]]);export{ga as default};
