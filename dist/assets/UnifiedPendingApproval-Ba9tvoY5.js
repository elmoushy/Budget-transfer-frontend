import{c as Re,a as X,q as K,d as je,u as De,y as h,J as Te,r,o as xe,w as W,e as c,f as e,h as m,t as n,G as x,b as Z,l as U,v as ee,F as te,C as ae,n as y,I as Le,i as Me,H as $e,Y as Be,m as se,p as Ee,s as u,_ as Ue}from"./index-BbrWEb8V.js";import{E as Fe}from"./eye-BciYgjq2.js";import{C as Ve}from"./check-BKMAXzUO.js";/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=Re("search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),oe="https://lightidea.org:9000",ne={async fetchPendingTransfers(C=1,_=10,w="",g=""){const p=X();if(!p.token)throw new Error("Authentication token not found");try{return(await K.get(`${oe}/api/budget/transfers/list_underapprovel/`,{headers:{Authorization:`Bearer ${p.token}`},params:{page:C,page_size:_,code:g,search:w.trim()}})).data}catch(d){throw console.error("Error fetching transfers pending approval:",d),d}},async approveRejectTransfers(C,_,w=[]){const g=X();if(!g.token)throw new Error("Authentication token not found");try{return(await K.post(`${oe}/api/budget/transfers/adjd-approve-reject/`,{transaction_id:C,decide:C.map(()=>_),reason:w.length?w:C.map(()=>"")},{headers:{Authorization:`Bearer ${g.token}`}})).data}catch(p){throw console.error("Error approving/rejecting transfers:",p),p}}},Ne={class:"toolbar"},ze={class:"page-title"},Ye={class:"toolbar-right"},He={class:"search-container"},Oe=["placeholder"],Ge={key:0,class:"selection-bar"},Je={class:"selection-info"},Qe={class:"action-buttons"},Xe=["disabled"],Ke=["disabled"],We={key:1,class:"loading-container"},Ze={key:2,class:"table-container glass-panel"},et={class:"modern-table-wrapper"},tt={class:"modern-table"},at={class:"table-header"},st={class:"checkbox-column"},ot={class:"checkbox-container"},nt=["checked"],lt={class:"th-status"},rt={class:"th-code"},it={class:"th-request-date"},ct={class:"th-requested-by"},ut={class:"th-transaction-date"},dt={class:"th-actions"},vt={class:"checkbox-column"},pt={class:"checkbox-container"},ht=["onChange","checked"],_t={class:"td-status"},gt={class:"td-code"},ft={class:"td-request-date"},bt={class:"td-requested-by"},mt={class:"td-transaction-date"},kt={class:"td-actions"},yt={class:"action-buttons-group"},Ct=["onClick"],wt=["onClick"],Pt=["onClick"],At={key:"no-results"},St={colspan:"7",class:"no-results"},qt={key:3,class:"pagination-wrapper glass-panel"},Rt={class:"pagination-info"},jt={class:"pagination-text"},Dt={class:"pagination-controls"},Tt=["disabled"],xt=["disabled"],Lt={class:"page-numbers"},Mt=["onClick","disabled"],$t=["disabled"],Bt=["disabled"],Et={class:"modal-header"},Ut={class:"modal-body"},Ft={key:0,class:"reason-container"},Vt={for:"rejection-reason",class:"reason-label"},It=["placeholder"],Nt={key:0,class:"reason-error"},zt={class:"modal-footer"},Yt=["disabled"],Ht={class:"modal-header"},Ot={class:"modal-body"},Gt={class:"modal-footer"},R=10,Jt=je({name:"PendingApprovalPage",__name:"UnifiedPendingApproval",setup(C){const _=Te(),w=Ee(),g=De(),p={EnhancementsPendingApproval:{title:{ar:"المناقلات قيد الاعتماد",en:"Transfers Pending Approval"},apiCode:"FAR",detailRoute:"/cost-center-transfer/:id",showViewButton:!1,headers:{ar:{stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},en:{stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"}}},ContractsPendingApproval:{title:{ar:"العقود قيد الاعتماد",en:"Contracts Pending Approval"},apiCode:"FAD",detailRoute:"/contracts/:id",showViewButton:!0,headers:{ar:{stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},en:{stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"}}},SettlementsPendingApproval:{title:{ar:"التسويات قيد الاعتماد",en:"Settlements Pending Approval"},apiCode:"AFR",detailRoute:"/settlements/:id",showViewButton:!1,headers:{ar:{stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},en:{stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"}}}},d=h(()=>p[_.name]||p.EnhancementsPendingApproval),o=h(()=>g.language==="ar"),F=h(()=>g.darkMode),le=h(()=>o.value?d.value.title.ar:d.value.title.en),j=h(()=>o.value?d.value.headers.ar:d.value.headers.en),D=r([]),k=r(0),L=r(!1),M=r(!1),V=r(""),$=r(!1);function re(a){return{pending:o.value?"قيد الانتظار":"Pending","under-review":o.value?"قيد المراجعة":"Under Review",approved:o.value?"تمت الموافقة":"Approved",rejected:o.value?"تم الرفض":"Rejected"}[a.toLowerCase()]||a}function ie(a){try{const t=new Date(a);return new Intl.DateTimeFormat(o.value?"ar-SA":"en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(t)}catch{return a}}function J(a){return d.value.detailRoute.replace(":id",a.transaction_id.toString())}const i=r([]),ce=h(()=>S.value.length>0&&i.value.length===S.value.length);function I(a){return i.value.some(t=>t.transaction_id===a.transaction_id)}function ue(a){I(a)?i.value=i.value.filter(t=>t.transaction_id!==a.transaction_id):i.value.push(a)}function de(a){a.target.checked?i.value=[...S.value]:i.value=[]}function ve(a){const t=a.toLowerCase();return t==="approved"?"row-approved":t==="rejected"?"row-rejected":t==="under-review"?"row-review":"row-pending"}const P=r(""),l=r(1),N=r(null);function pe(){N.value&&clearTimeout(N.value),N.value=window.setTimeout(()=>{l.value=1,v()},500)}function he(){P.value="",l.value=1,v()}async function v(){try{L.value=!0,console.log(`[UnifiedPendingApproval] Loading data for route: ${String(_.name)}, API code: ${d.value.apiCode}`);const a=await ne.fetchPendingTransfers(l.value,R,P.value,d.value.apiCode);console.log("[UnifiedPendingApproval] API Response:",a),_.name==="ContractsPendingApproval"?(console.log("[UnifiedPendingApproval] Using Contracts field mapping"),D.value=(a.results||[]).map(t=>({transaction_id:Number(t.id||t.transaction_id)||0,status:String(t.status||""),code:String(t.code||""),request_date:String(t.request_date||""),requested_by:String(t.requested_by||""),transaction_date:String(t.transaction_date||"")}))):(console.log("[UnifiedPendingApproval] Using Transfers/Settlements field mapping"),D.value=(a.results||[]).map(t=>({transaction_id:Number(t.id||t.transaction_id)||0,status:String(t.status||""),code:String(t.transfer_id||t.code||""),request_date:String(t.created_at||t.request_date||""),requested_by:String(t.user_name||t.requested_by||""),transaction_date:String(t.updated_at||t.transaction_date||"")}))),console.log("[UnifiedPendingApproval] Mapped rows:",D.value),k.value=a.count||0,i.value=[]}catch(a){console.error("Failed to load transfers:",a),V.value=o.value?"حدث خطأ أثناء تحميل البيانات. يرجى المحاولة مرة أخرى.":"An error occurred while loading data. Please try again.",$.value=!0,D.value=[],k.value=0}finally{L.value=!1}}function _e(){l.value<A.value&&(l.value++,v())}function ge(){l.value>1&&(l.value--,v())}function fe(){l.value=1,v()}function be(){l.value=A.value,v()}function me(a){a>=1&&a<=A.value&&a!==-1&&(l.value=a,v())}const A=h(()=>Math.ceil(k.value/R)),ke=h(()=>{const a=[],t=A.value,b=l.value;if(t<=7)for(let s=1;s<=t;s++)a.push(s);else if(a.push(1),b<=4){for(let s=2;s<=5;s++)a.push(s);a.push(-1),a.push(t)}else if(b>=t-3){a.push(-1);for(let s=t-4;s<=t;s++)a.push(s)}else{a.push(-1);for(let s=b-1;s<=b+1;s++)a.push(s);a.push(-1),a.push(t)}return a}),S=h(()=>D.value);function ye(a){const t=J(a);w.push({path:t,query:{viewOnly:"true"}})}function Ce(a){B("approve",[a])}function we(a){B("reject",[a])}function Pe(){B("approve",i.value)}function Ae(){B("reject",i.value)}const z=r(!1),f=r("approve"),Y=r(""),H=r(""),Q=r([]),T=r(""),O=r(!1);function B(a,t){f.value=a,Q.value=t,T.value="",O.value=!1,a==="approve"?(Y.value=o.value?"تمت الموافقة بنجاح":"Approval Submitted Successfully",H.value=o.value?"شكرًا لك. تم تقديم الموافقة الخاصة بك بنجاح، وستستمر العملية إلى الخطوة التالية.":"Thank you. Your approval has been submitted successfully, and the process will continue to the next step."):(Y.value=o.value?"تم الرفض بنجاح":"Rejection Submitted Successfully",H.value=o.value?"شكرًا لك. تم تقديم رفضك بنجاح، وستستمر العملية إلى الخطوة التالية.":"Thank you. Your rejection has been submitted successfully, and the process will continue to the next step."),z.value=!0}function E(){z.value=!1}function G(){$.value=!1}async function Se(){if(f.value==="reject"&&!T.value.trim()){O.value=!0;return}try{M.value=!0;const a=Q.value.map(qe=>qe.transaction_id),t=f.value==="approve"?2:3,b=f.value==="reject"?a.map(()=>T.value.trim()):[];await ne.approveRejectTransfers(a,t,b),await v(),E();const s=f.value==="approve"?o.value?"الموافقة":"approval":o.value?"الرفض":"rejection",q=o.value?`تم ${s} بنجاح`:`${s.charAt(0).toUpperCase()+s.slice(1)} successful`;console.log(q)}catch(a){console.error("Error processing action:",a),V.value=o.value?"حدث خطأ أثناء معالجة الطلب. يرجى المحاولة مرة أخرى.":"An error occurred while processing the request. Please try again.",$.value=!0}finally{M.value=!1}}return xe(()=>{v()}),W(()=>_.name,()=>{l.value=1,P.value="",i.value=[],v()}),W(()=>g.language,()=>{v()}),(a,t)=>{const b=$e("router-link");return u(),c("div",{class:y(["approval-page",{"dark-mode":F.value}])},[e("div",Ne,[e("h1",ze,n(le.value),1),e("div",Ye,[e("div",He,[x(U(Ie),{class:"search-icon"}),Z(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>P.value=s),type:"search",placeholder:o.value?"بحث...":"Search...",class:"input-search",onInput:pe},null,40,Oe),[[ee,P.value]]),P.value?(u(),c("button",{key:0,onClick:he,class:"clear-search"},"×")):m("",!0)])])]),i.value.length>0?(u(),c("div",Ge,[e("span",Je,n(o.value?`تم اختيار ${i.value.length} عنصر`:`${i.value.length} items selected`),1),e("div",Qe,[e("button",{onClick:Ae,class:"btn-reject",disabled:i.value.length===0},n(o.value?"رفض":"Reject"),9,Xe),e("button",{onClick:Pe,class:"btn-approve",disabled:i.value.length===0},n(o.value?"موافقة":"Approve"),9,Ke)])])):m("",!0),L.value?(u(),c("div",We,[t[4]||(t[4]=e("div",{class:"loader"},null,-1)),e("p",null,n(o.value?"جاري التحميل...":"Loading..."),1)])):(u(),c("div",Ze,[e("div",et,[e("table",tt,[e("thead",null,[e("tr",at,[e("th",st,[e("label",ot,[e("input",{type:"checkbox",onChange:de,checked:ce.value},null,40,nt),t[5]||(t[5]=e("span",{class:"checkmark"},null,-1))])]),e("th",lt,n(j.value.stateLevel),1),e("th",rt,n(j.value.code),1),e("th",it,n(j.value.requestDate),1),e("th",ct,n(j.value.requestedBy),1),e("th",ut,n(j.value.transactionDate),1),e("th",dt,n(o.value?"إجراءات":"Actions"),1)])]),e("tbody",null,[(u(!0),c(te,null,ae(S.value,s=>(u(),c("tr",{key:s.transaction_id,class:y([ve(s.status),{"row-selected":I(s)},"table-row"])},[e("td",vt,[e("label",pt,[e("input",{type:"checkbox",onChange:q=>ue(s),checked:I(s)},null,40,ht),t[6]||(t[6]=e("span",{class:"checkmark"},null,-1))])]),e("td",_t,[e("span",{class:y(["status-badge","status-"+s.status.toLowerCase()])},n(re(s.status)),3)]),e("td",gt,[x(b,{to:{path:J(s),query:{viewOnly:"true"}},class:"code-link"},{default:Le(()=>[Me(n(s.code),1)]),_:2},1032,["to"])]),e("td",ft,n(ie(s.request_date)),1),e("td",bt,n(s.requested_by),1),e("td",mt,n(s.transaction_date),1),e("td",kt,[e("div",yt,[e("button",{class:"action-btn view-btn",onClick:q=>ye(s),title:"View"},[x(U(Fe))],8,Ct),e("button",{class:"action-btn approve-btn",onClick:q=>Ce(s),title:"Approve"},[x(U(Ve))],8,wt),e("button",{class:"action-btn reject-btn",onClick:q=>we(s),title:"Reject"},[x(U(Be))],8,Pt)])])],2))),128)),S.value.length===0?(u(),c("tr",At,[e("td",St,n(o.value?"لا توجد نتائج":"No results found"),1)])):m("",!0)])])])])),!L.value&&S.value.length>0?(u(),c("div",qt,[e("div",Rt,[e("span",jt,n(o.value?`عرض ${(l.value-1)*R+1} إلى ${Math.min(l.value*R,k.value)} من ${k.value} عنصر`:`Showing ${(l.value-1)*R+1} to ${Math.min(l.value*R,k.value)} of ${k.value} items`),1)]),e("div",Dt,[e("button",{class:"pagination-btn pagination-btn-first",onClick:fe,disabled:l.value===1,title:"First Page"}," ⟪ ",8,Tt),e("button",{class:"pagination-btn pagination-btn-prev",onClick:ge,disabled:l.value===1,title:"Previous Page"}," ⟨ ",8,xt),e("div",Lt,[(u(!0),c(te,null,ae(ke.value,s=>(u(),c("button",{key:s,class:y(["pagination-btn page-number",{active:s===l.value,ellipsis:s===-1}]),onClick:q=>me(s),disabled:s===-1},n(s===-1?"...":s),11,Mt))),128))]),e("button",{class:"pagination-btn pagination-btn-next",onClick:_e,disabled:l.value>=A.value,title:"Next Page"}," ⟩ ",8,$t),e("button",{class:"pagination-btn pagination-btn-last",onClick:be,disabled:l.value>=A.value,title:"Last Page"}," ⟫ ",8,Bt)])])):m("",!0),z.value?(u(),c("div",{key:4,class:"modal-overlay",onClick:E},[e("div",{class:y(["modal-container",{"dark-mode":F.value}]),onClick:t[2]||(t[2]=se(()=>{},["stop"]))},[e("div",Et,[e("h2",null,n(Y.value),1),e("button",{class:"close-modal",onClick:E},"×")]),e("div",Ut,[e("p",null,n(H.value),1),f.value==="reject"?(u(),c("div",Ft,[e("label",Vt,n(o.value?"سبب الرفض:":"Rejection Reason:"),1),Z(e("textarea",{id:"rejection-reason","onUpdate:modelValue":t[1]||(t[1]=s=>T.value=s),placeholder:o.value?"يرجى ذكر سبب الرفض...":"Please provide a reason for rejection...",class:"reason-textarea",rows:"3"},null,8,It),[[ee,T.value]]),O.value?(u(),c("p",Nt,n(o.value?"سبب الرفض مطلوب":"Rejection reason is required"),1)):m("",!0)])):m("",!0)]),e("div",zt,[e("button",{class:"btn-secondary",onClick:E},n(o.value?"إلغاء":"Cancel"),1),e("button",{class:y(f.value==="approve"?"btn-approve":"btn-reject"),onClick:Se,disabled:M.value},n(M.value?o.value?"جاري المعالجة...":"Processing...":f.value==="approve"?o.value?"موافقة":"Approve":o.value?"رفض":"Reject"),11,Yt)])],2)])):m("",!0),$.value?(u(),c("div",{key:5,class:"modal-overlay",onClick:G},[e("div",{class:y(["modal-container error-modal",{"dark-mode":F.value}]),onClick:t[3]||(t[3]=se(()=>{},["stop"]))},[e("div",Ht,[e("h2",null,n(o.value?"خطأ":"Error"),1),e("button",{class:"close-modal",onClick:G},"×")]),e("div",Ot,[e("p",null,n(V.value),1)]),e("div",Gt,[e("button",{class:"btn-secondary",onClick:G},n(o.value?"إغلاق":"Close"),1)])],2)])):m("",!0)],2)}}}),Wt=Ue(Jt,[["__scopeId","data-v-2167b4df"]]);export{Wt as default};
