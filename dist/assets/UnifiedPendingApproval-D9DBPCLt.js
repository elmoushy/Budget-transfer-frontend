import{c as Se,a as Y,q as K,d as je,u as De,y as _,J as $e,r,o as Te,w as W,e as u,f as e,h as m,t as n,G as T,b as Z,l as U,v as ee,F as te,C as ae,n as y,I as xe,i as Le,H as Me,Y as Be,m as se,p as Ee,s as d,_ as Ue}from"./index-1DZghGKI.js";import{E as Fe}from"./eye-7IPFBfjA.js";import{C as Ve}from"./check-B0BoeOkJ.js";/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=Se("search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),oe="https://lightidea.org:9000",ne={async fetchPendingTransfers(C=1,g=10,w="",f=""){const h=Y();if(!h.token)throw new Error("Authentication token not found");try{return(await K.get(`${oe}/api/budget/transfers/list_underapprovel/`,{headers:{Authorization:`Bearer ${h.token}`},params:{page:C,page_size:g,code:f,search:w.trim()}})).data}catch(v){throw console.error("Error fetching transfers pending approval:",v),v}},async approveRejectTransfers(C,g,w=[]){const f=Y();if(!f.token)throw new Error("Authentication token not found");try{return(await K.post(`${oe}/api/budget/transfers/adjd-approve-reject/`,{transaction_id:C,decide:C.map(()=>g),reason:w.length?w:C.map(()=>"")},{headers:{Authorization:`Bearer ${f.token}`}})).data}catch(h){throw console.error("Error approving/rejecting transfers:",h),h}}},Ne={class:"toolbar"},ze={class:"page-title"},He={class:"toolbar-right"},Oe={class:"search-container"},Ge=["placeholder"],Je={key:0,class:"selection-bar"},Qe={class:"selection-info"},Xe={class:"action-buttons"},Ye=["disabled"],Ke=["disabled"],We={key:1,class:"loading-container"},Ze={key:2,class:"table-container glass-panel"},et={class:"modern-table-wrapper"},tt={class:"modern-table"},at={class:"table-header"},st={class:"checkbox-column"},ot={class:"checkbox-container"},nt=["checked"],lt={class:"th-status"},rt={class:"th-code"},it={class:"th-request-date"},ct={class:"th-requested-by"},ut={class:"th-transaction-date"},dt={class:"th-actions"},vt={class:"checkbox-column"},pt={class:"checkbox-container"},ht=["onChange","checked"],_t={class:"td-status"},gt={class:"td-code"},ft={class:"td-request-date"},bt={class:"td-requested-by"},mt={class:"td-transaction-date"},kt={class:"td-actions"},yt={class:"action-buttons-group"},Ct=["onClick"],wt=["onClick"],Pt=["onClick"],qt={key:"no-results"},At={colspan:"7",class:"no-results"},Rt={key:3,class:"pagination-wrapper glass-panel"},St={class:"pagination-info"},jt={class:"pagination-text"},Dt={class:"pagination-controls"},$t=["disabled"],Tt=["disabled"],xt={class:"page-numbers"},Lt=["onClick","disabled"],Mt=["disabled"],Bt=["disabled"],Et={class:"modal-header"},Ut={class:"modal-body"},Ft={key:0,class:"reason-container"},Vt={for:"rejection-reason",class:"reason-label"},It=["placeholder"],Nt={key:0,class:"reason-error"},zt={class:"modal-footer"},Ht=["disabled"],Ot={class:"modal-header"},Gt={class:"modal-body"},Jt={class:"modal-footer"},S=10,Qt=je({name:"PendingApprovalPage",__name:"UnifiedPendingApproval",setup(C){const g=$e(),w=Ee(),f=De(),h={EnhancementsPendingApproval:{title:{ar:"المناقلات قيد الاعتماد",en:"Transfers Pending Approval"},apiCode:"FAR",detailRoute:"/cost-center-transfer/:id",showViewButton:!1,headers:{ar:{stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},en:{stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"}}},ContractsPendingApproval:{title:{ar:"العقود قيد الاعتماد",en:"Contracts Pending Approval"},apiCode:"FAD",detailRoute:"/contracts/:id",showViewButton:!0,headers:{ar:{stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},en:{stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"}}},SettlementsPendingApproval:{title:{ar:"التسويات قيد الاعتماد",en:"Settlements Pending Approval"},apiCode:"AFR",detailRoute:"/settlements/:id",showViewButton:!1,headers:{ar:{stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},en:{stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"}}}},v=_(()=>h[g.name]||h.EnhancementsPendingApproval),o=_(()=>f.language==="ar"),F=_(()=>f.darkMode),le=_(()=>o.value?v.value.title.ar:v.value.title.en),j=_(()=>o.value?v.value.headers.ar:v.value.headers.en),D=r([]),k=r(0),x=r(!1),L=r(!1),V=r(""),M=r(!1);function re(a){return{pending:o.value?"قيد الانتظار":"Pending","under-review":o.value?"قيد المراجعة":"Under Review",approved:o.value?"تمت الموافقة":"Approved",rejected:o.value?"تم الرفض":"Rejected"}[a.toLowerCase()]||a}function ie(a){try{const t=new Date(a);return new Intl.DateTimeFormat(o.value?"ar-SA":"en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(t)}catch{return a}}function Q(a){return v.value.detailRoute.replace(":id",a.transaction_id.toString())}const i=r([]),ce=_(()=>A.value.length>0&&i.value.length===A.value.length);function I(a){return i.value.some(t=>t.transaction_id===a.transaction_id)}function ue(a){I(a)?i.value=i.value.filter(t=>t.transaction_id!==a.transaction_id):i.value.push(a)}function de(a){a.target.checked?i.value=[...A.value]:i.value=[]}function ve(a){const t=a.toLowerCase();return t==="approved"?"row-approved":t==="rejected"?"row-rejected":t==="under-review"?"row-review":"row-pending"}const P=r(""),l=r(1),N=r(null);function pe(){N.value&&clearTimeout(N.value),N.value=window.setTimeout(()=>{l.value=1,p()},500)}function he(){P.value="",l.value=1,p()}async function p(){try{x.value=!0,console.log(`[UnifiedPendingApproval] Loading data for route: ${String(g.name)}, API code: ${v.value.apiCode}`);const a=await ne.fetchPendingTransfers(l.value,S,P.value,v.value.apiCode);console.log("[UnifiedPendingApproval] API Response:",a),g.name==="ContractsPendingApproval"?(console.log("[UnifiedPendingApproval] Using Contracts field mapping"),D.value=(a.results||[]).map(t=>({transaction_id:Number(t.id||t.transaction_id)||0,status:String(t.status||""),code:String(t.code||""),request_date:String(t.request_date||""),requested_by:String(t.requested_by||""),transaction_date:String(t.transaction_date||"")}))):(console.log("[UnifiedPendingApproval] Using Transfers/Settlements field mapping"),D.value=(a.results||[]).map(t=>({transaction_id:Number(t.id||t.transaction_id)||0,status:String(t.status||""),code:String(t.transfer_id||t.code||""),request_date:String(t.created_at||t.request_date||""),requested_by:String(t.user_name||t.requested_by||""),transaction_date:String(t.updated_at||t.transaction_date||"")}))),console.log("[UnifiedPendingApproval] Mapped rows:",D.value),k.value=a.count||0,i.value=[]}catch(a){console.error("Failed to load transfers:",a),V.value=o.value?"حدث خطأ أثناء تحميل البيانات. يرجى المحاولة مرة أخرى.":"An error occurred while loading data. Please try again.",M.value=!0,D.value=[],k.value=0}finally{x.value=!1}}function _e(){l.value<q.value&&(l.value++,p())}function ge(){l.value>1&&(l.value--,p())}function fe(){l.value=1,p()}function be(){l.value=q.value,p()}function me(a){a>=1&&a<=q.value&&a!==-1&&(l.value=a,p())}const q=_(()=>Math.ceil(k.value/S)),ke=_(()=>{const a=[],t=q.value,c=l.value;if(t<=7)for(let s=1;s<=t;s++)a.push(s);else if(a.push(1),c<=4){for(let s=2;s<=5;s++)a.push(s);a.push(-1),a.push(t)}else if(c>=t-3){a.push(-1);for(let s=t-4;s<=t;s++)a.push(s)}else{a.push(-1);for(let s=c-1;s<=c+1;s++)a.push(s);a.push(-1),a.push(t)}return a}),A=_(()=>D.value);function ye(a){const t=Q(a);w.push({path:t,query:{viewOnly:"true"}})}function Ce(a){B("approve",[a])}function we(a){B("reject",[a])}function Pe(){B("approve",i.value)}function qe(){B("reject",i.value)}const z=r(!1),b=r("approve"),H=r(""),O=r(""),X=r([]),$=r(""),G=r(!1);function B(a,t){b.value=a,X.value=t,$.value="",G.value=!1;const c=t.length;a==="approve"?(H.value=o.value?"تأكيد الموافقة":"Confirm Approval",O.value=o.value?`هل أنت متأكد من موافقتك على ${c} من المناقلات؟`:`Are you sure you want to approve ${c} transfer request${c===1?"":"s"}?`):(H.value=o.value?"تأكيد الرفض":"Confirm Rejection",O.value=o.value?`هل أنت متأكد من رفضك لـ ${c} من المناقلات؟`:`Are you sure you want to reject ${c} transfer request${c===1?"":"s"}?`),z.value=!0}function E(){z.value=!1}function J(){M.value=!1}async function Ae(){if(b.value==="reject"&&!$.value.trim()){G.value=!0;return}try{L.value=!0;const a=X.value.map(Re=>Re.transaction_id),t=b.value==="approve"?2:3,c=b.value==="reject"?a.map(()=>$.value.trim()):[];await ne.approveRejectTransfers(a,t,c),await p(),E();const s=b.value==="approve"?o.value?"الموافقة":"approval":o.value?"الرفض":"rejection",R=o.value?`تم ${s} بنجاح`:`${s.charAt(0).toUpperCase()+s.slice(1)} successful`;console.log(R)}catch(a){console.error("Error processing action:",a),V.value=o.value?"حدث خطأ أثناء معالجة الطلب. يرجى المحاولة مرة أخرى.":"An error occurred while processing the request. Please try again.",M.value=!0}finally{L.value=!1}}return Te(()=>{p()}),W(()=>g.name,()=>{l.value=1,P.value="",i.value=[],p()}),W(()=>f.language,()=>{p()}),(a,t)=>{const c=Me("router-link");return d(),u("div",{class:y(["approval-page",{"dark-mode":F.value}])},[e("div",Ne,[e("h1",ze,n(le.value),1),e("div",He,[e("div",Oe,[T(U(Ie),{class:"search-icon"}),Z(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>P.value=s),type:"search",placeholder:o.value?"بحث...":"Search...",class:"input-search",onInput:pe},null,40,Ge),[[ee,P.value]]),P.value?(d(),u("button",{key:0,onClick:he,class:"clear-search"},"×")):m("",!0)])])]),i.value.length>0?(d(),u("div",Je,[e("span",Qe,n(o.value?`تم اختيار ${i.value.length} عنصر`:`${i.value.length} items selected`),1),e("div",Xe,[e("button",{onClick:qe,class:"btn-reject",disabled:i.value.length===0},n(o.value?"رفض":"Reject"),9,Ye),e("button",{onClick:Pe,class:"btn-approve",disabled:i.value.length===0},n(o.value?"موافقة":"Approve"),9,Ke)])])):m("",!0),x.value?(d(),u("div",We,[t[4]||(t[4]=e("div",{class:"loader"},null,-1)),e("p",null,n(o.value?"جاري التحميل...":"Loading..."),1)])):(d(),u("div",Ze,[e("div",et,[e("table",tt,[e("thead",null,[e("tr",at,[e("th",st,[e("label",ot,[e("input",{type:"checkbox",onChange:de,checked:ce.value},null,40,nt),t[5]||(t[5]=e("span",{class:"checkmark"},null,-1))])]),e("th",lt,n(j.value.stateLevel),1),e("th",rt,n(j.value.code),1),e("th",it,n(j.value.requestDate),1),e("th",ct,n(j.value.requestedBy),1),e("th",ut,n(j.value.transactionDate),1),e("th",dt,n(o.value?"إجراءات":"Actions"),1)])]),e("tbody",null,[(d(!0),u(te,null,ae(A.value,s=>(d(),u("tr",{key:s.transaction_id,class:y([ve(s.status),{"row-selected":I(s)},"table-row"])},[e("td",vt,[e("label",pt,[e("input",{type:"checkbox",onChange:R=>ue(s),checked:I(s)},null,40,ht),t[6]||(t[6]=e("span",{class:"checkmark"},null,-1))])]),e("td",_t,[e("span",{class:y(["status-badge","status-"+s.status.toLowerCase()])},n(re(s.status)),3)]),e("td",gt,[T(c,{to:{path:Q(s),query:{viewOnly:"true"}},class:"code-link"},{default:xe(()=>[Le(n(s.code),1)]),_:2},1032,["to"])]),e("td",ft,n(ie(s.request_date)),1),e("td",bt,n(s.requested_by),1),e("td",mt,n(s.transaction_date),1),e("td",kt,[e("div",yt,[e("button",{class:"action-btn view-btn",onClick:R=>ye(s),title:"View"},[T(U(Fe))],8,Ct),e("button",{class:"action-btn approve-btn",onClick:R=>Ce(s),title:"Approve"},[T(U(Ve))],8,wt),e("button",{class:"action-btn reject-btn",onClick:R=>we(s),title:"Reject"},[T(U(Be))],8,Pt)])])],2))),128)),A.value.length===0?(d(),u("tr",qt,[e("td",At,n(o.value?"لا توجد نتائج":"No results found"),1)])):m("",!0)])])])])),!x.value&&A.value.length>0?(d(),u("div",Rt,[e("div",St,[e("span",jt,n(o.value?`عرض ${(l.value-1)*S+1} إلى ${Math.min(l.value*S,k.value)} من ${k.value} عنصر`:`Showing ${(l.value-1)*S+1} to ${Math.min(l.value*S,k.value)} of ${k.value} items`),1)]),e("div",Dt,[e("button",{class:"pagination-btn pagination-btn-first",onClick:fe,disabled:l.value===1,title:"First Page"}," ⟪ ",8,$t),e("button",{class:"pagination-btn pagination-btn-prev",onClick:ge,disabled:l.value===1,title:"Previous Page"}," ⟨ ",8,Tt),e("div",xt,[(d(!0),u(te,null,ae(ke.value,s=>(d(),u("button",{key:s,class:y(["pagination-btn page-number",{active:s===l.value,ellipsis:s===-1}]),onClick:R=>me(s),disabled:s===-1},n(s===-1?"...":s),11,Lt))),128))]),e("button",{class:"pagination-btn pagination-btn-next",onClick:_e,disabled:l.value>=q.value,title:"Next Page"}," ⟩ ",8,Mt),e("button",{class:"pagination-btn pagination-btn-last",onClick:be,disabled:l.value>=q.value,title:"Last Page"}," ⟫ ",8,Bt)])])):m("",!0),z.value?(d(),u("div",{key:4,class:"modal-overlay",onClick:E},[e("div",{class:y(["modal-container",{"dark-mode":F.value}]),onClick:t[2]||(t[2]=se(()=>{},["stop"]))},[e("div",Et,[e("h2",null,n(H.value),1),e("button",{class:"close-modal",onClick:E},"×")]),e("div",Ut,[e("p",null,n(O.value),1),b.value==="reject"?(d(),u("div",Ft,[e("label",Vt,n(o.value?"سبب الرفض:":"Rejection Reason:"),1),Z(e("textarea",{id:"rejection-reason","onUpdate:modelValue":t[1]||(t[1]=s=>$.value=s),placeholder:o.value?"يرجى ذكر سبب الرفض...":"Please provide a reason for rejection...",class:"reason-textarea",rows:"3"},null,8,It),[[ee,$.value]]),G.value?(d(),u("p",Nt,n(o.value?"سبب الرفض مطلوب":"Rejection reason is required"),1)):m("",!0)])):m("",!0)]),e("div",zt,[e("button",{class:"btn-secondary",onClick:E},n(o.value?"إلغاء":"Cancel"),1),e("button",{class:y(b.value==="approve"?"btn-approve":"btn-reject"),onClick:Ae,disabled:L.value},n(L.value?o.value?"جاري المعالجة...":"Processing...":b.value==="approve"?o.value?"موافقة":"Approve":o.value?"رفض":"Reject"),11,Ht)])],2)])):m("",!0),M.value?(d(),u("div",{key:5,class:"modal-overlay",onClick:J},[e("div",{class:y(["modal-container error-modal",{"dark-mode":F.value}]),onClick:t[3]||(t[3]=se(()=>{},["stop"]))},[e("div",Ot,[e("h2",null,n(o.value?"خطأ":"Error"),1),e("button",{class:"close-modal",onClick:J},"×")]),e("div",Gt,[e("p",null,n(V.value),1)]),e("div",Jt,[e("button",{class:"btn-secondary",onClick:J},n(o.value?"إغلاق":"Close"),1)])],2)])):m("",!0)],2)}}}),Wt=Ue(Qt,[["__scopeId","data-v-83733c26"]]);export{Wt as default};
