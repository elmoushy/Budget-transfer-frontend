import{d as ve,u as pe,r as l,o as _e,w as H,y as S,e as i,f as e,h as p,t as n,G as C,b as G,l as A,v as z,I as he,F as fe,C as be,n as d,X as ge,T as me,m as Q,q as u,s as ke}from"./index-DKsQNwYd.js";import{T as N,S as ye}from"./TransfersFlowService-CqxkTTjA.js";import{E as Ce}from"./eye-BzY7gzeZ.js";import{C as we}from"./check-CvjDXZux.js";const je={class:"toolbar"},Re={class:"page-title"},xe={class:"toolbar-right"},Pe={class:"search-container"},Se=["placeholder"],Ae={key:0,class:"selection-bar"},Me={class:"selection-info"},qe={class:"action-buttons"},Te=["disabled"],De=["disabled"],$e={key:1,class:"loading-container"},Le={key:2,class:"table-container"},Ie={key:"head"},Be={class:"checkbox-column"},Ee={class:"checkbox-container"},Ve=["checked"],Fe={style:{"text-align":"center"}},Ne={style:{"text-align":"center"}},Ue={style:{"text-align":"center"}},He={style:{"text-align":"center"}},Ge={style:{"text-align":"center"}},ze={style:{"text-align":"center"}},Qe={key:"body"},Xe={class:"checkbox-column"},Je={class:"checkbox-container"},Ke=["onChange","checked"],Oe={class:"code-cell"},We={class:"action-buttons-cell"},Ye=["onClick"],Ze=["onClick"],et=["onClick"],tt={key:"no-results"},at={colspan:"7",class:"no-results"},st={class:"pagination"},ot=["disabled"],nt={class:"page-info"},lt=["disabled"],ct={class:"modal-header"},rt={class:"modal-body"},it={key:0,class:"reason-container"},ut={for:"rejection-reason",class:"reason-label"},dt=["placeholder"],vt={key:0,class:"reason-error"},pt={class:"modal-footer"},_t=["disabled"],ht={class:"modal-header"},ft={class:"modal-body"},bt={class:"modal-footer"},X=10,gt=ve({name:"SettlementsPendingApprovalPage",__name:"SettlementsPendingApproval",setup(mt){const w=pe(),s=l(!1),f=l(!1);_e(()=>{s.value=w.language==="ar",f.value=w.darkMode,_()}),H(()=>w.language,a=>s.value=a==="ar"),H(()=>w.darkMode,a=>f.value=a);const J={stateLevel:"State Level",code:"Code",requestDate:"Request Date",requestedBy:"Requested By",transactionDate:"Transaction Date"},K={stateLevel:"حالة الموافقة",code:"الكود",requestDate:"تاريخ طلب المناقلة",requestedBy:"اسم طالب المناقلة",transactionDate:"شهر المناقلة"},b=S(()=>s.value?K:J),M=l([]),q=l(0),T=l(!1),j=l(!1),D=l(""),R=l(!1);function O(a){return{pending:s.value?"قيد الانتظار":"Pending","under-review":s.value?"قيد المراجعة":"Under Review",approved:s.value?"تمت الموافقة":"Approved",rejected:s.value?"تم الرفض":"Rejected"}[a.toLowerCase()]||a}function W(a){try{const t=new Date(a);return new Intl.DateTimeFormat(s.value?"ar-SA":"en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(t)}catch{return a}}const c=l([]),Y=S(()=>k.value.length>0&&c.value.length===k.value.length);function $(a){return c.value.some(t=>t.transaction_id===a.transaction_id)}function Z(a){$(a)?c.value=c.value.filter(t=>t.transaction_id!==a.transaction_id):c.value.push(a)}function ee(a){a.target.checked?c.value=[...k.value]:c.value=[]}function te(a){const t=a.toLowerCase();return t==="approved"?"row-approved":t==="rejected"?"row-rejected":t==="under-review"?"row-review":"row-pending"}const g=l(""),r=l(1),L=l(null);function ae(){L.value&&clearTimeout(L.value),L.value=window.setTimeout(()=>{r.value=1,_()},500)}function se(){g.value="",r.value=1,_()}async function _(){try{T.value=!0;const a=await N.fetchPendingTransfers(r.value,X,g.value,"AFR");M.value=(a.results||[]).map(t=>({transaction_id:t.id||t.transaction_id,status:t.status,code:t.transfer_id||t.code||"",request_date:t.created_at||t.request_date||"",requested_by:t.user_name||t.requested_by||"",transaction_date:t.updated_at||t.transaction_date||""})),q.value=a.count||0,c.value=[]}catch(a){console.error("Failed to load transfers:",a),D.value=s.value?"حدث خطأ أثناء تحميل البيانات. يرجى المحاولة مرة أخرى.":"An error occurred while loading data. Please try again.",R.value=!0,M.value=[],q.value=0}finally{T.value=!1}}function oe(){r.value<m.value&&(r.value++,_())}function ne(){r.value>1&&(r.value--,_())}const m=S(()=>Math.ceil(q.value/X)),k=S(()=>M.value);function le(a){console.log("View details for row:",a.transaction_id)}function ce(a){x("approve",[a])}function re(a){x("reject",[a])}function ie(){x("approve",c.value)}function ue(){x("reject",c.value)}const I=l(!1),h=l("approve"),B=l(""),E=l(""),U=l([]),y=l(""),V=l(!1);function x(a,t){h.value=a,U.value=t,y.value="",V.value=!1;const o=t.length;a==="approve"?(B.value=s.value?"تأكيد الموافقة":"Confirm Approval",E.value=s.value?`هل أنت متأكد من موافقتك على ${o} من المناقلات؟`:`Are you sure you want to approve ${o} transfer request${o===1?"":"s"}?`):(B.value=s.value?"تأكيد الرفض":"Confirm Rejection",E.value=s.value?`هل أنت متأكد من رفضك لـ ${o} من المناقلات؟`:`Are you sure you want to reject ${o} transfer request${o===1?"":"s"}?`),I.value=!0}async function de(){if(h.value==="reject"&&!y.value.trim()){V.value=!0;return}try{j.value=!0;const a=h.value,o=U.value.map(v=>v.transaction_id);if(a==="approve")await N.approveRejectTransfers(o,2);else{const v=o.map(()=>y.value.trim());await N.approveRejectTransfers(o,3,v)}await _(),P()}catch(a){console.error("Error processing action:",a),D.value=s.value?"حدث خطأ أثناء معالجة الإجراء. يرجى المحاولة مرة أخرى.":"An error occurred while processing your action. Please try again.",R.value=!0}finally{j.value=!1}}function P(){I.value=!1}function F(){R.value=!1}return(a,t)=>(u(),i("div",{class:d(["approval-page",{"dark-mode":f.value}])},[e("div",je,[e("h1",Re,n(s.value?"المناقلات قيد الاعتماد":"Transfers Pending Approval"),1),e("div",xe,[e("div",Pe,[C(A(ye),{class:"search-icon"}),G(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>g.value=o),type:"search",placeholder:s.value?"بحث...":"Search...",class:"input-search",onInput:ae},null,40,Se),[[z,g.value]]),g.value?(u(),i("button",{key:0,onClick:se,class:"clear-search"},"×")):p("",!0)])])]),c.value.length>0?(u(),i("div",Ae,[e("span",Me,n(s.value?`تم اختيار ${c.value.length} عنصر`:`${c.value.length} items selected`),1),e("div",qe,[e("button",{onClick:ue,class:"btn-reject",disabled:c.value.length===0},n(s.value?"رفض":"Reject"),9,Te),e("button",{onClick:ie,class:"btn-approve",disabled:c.value.length===0},n(s.value?"موافقة":"Approve"),9,De)])])):p("",!0),T.value?(u(),i("div",$e,[t[4]||(t[4]=e("div",{class:"loader"},null,-1)),e("p",null,n(s.value?"جاري التحميل...":"Loading..."),1)])):(u(),i("div",Le,[C(me,{name:"table-fade",tag:"table",class:"main-table"},{default:he(()=>[e("thead",Ie,[e("tr",null,[e("th",Be,[e("label",Ee,[e("input",{type:"checkbox",onChange:ee,checked:Y.value},null,40,Ve),t[5]||(t[5]=e("span",{class:"checkmark"},null,-1))])]),e("th",Fe,n(b.value.stateLevel),1),e("th",Ne,n(b.value.code),1),e("th",Ue,n(b.value.requestDate),1),e("th",He,n(b.value.requestedBy),1),e("th",Ge,n(b.value.transactionDate),1),e("th",ze,n(s.value?"إجراءات":"Actions"),1)])]),e("tbody",Qe,[(u(!0),i(fe,null,be(k.value,o=>(u(),i("tr",{key:o.transaction_id,class:d([[te(o.status),{"row-selected":$(o)}],"table-row"])},[e("td",Xe,[e("label",Je,[e("input",{type:"checkbox",onChange:v=>Z(o),checked:$(o)},null,40,Ke),t[6]||(t[6]=e("span",{class:"checkmark"},null,-1))])]),e("td",null,[e("span",{class:d(["status-badge","status-"+o.status.toLowerCase()])},n(O(o.status)),3)]),e("td",Oe,n(o.code),1),e("td",null,n(W(o.request_date)),1),e("td",null,n(o.requested_by),1),e("td",null,n(o.transaction_date),1),e("td",null,[e("div",We,[e("button",{class:"icon-btn view-btn",onClick:v=>le(o),title:"View Details"},[C(A(Ce))],8,Ye),e("button",{class:"icon-btn approve-btn",onClick:v=>ce(o),title:"Approve"},[C(A(we))],8,Ze),e("button",{class:"icon-btn reject-btn",onClick:v=>re(o),title:"Reject"},[C(A(ge))],8,et)])])],2))),128)),k.value.length===0?(u(),i("tr",tt,[e("td",at,n(s.value?"لا توجد نتائج":"No results found"),1)])):p("",!0)])]),_:1})])),e("div",st,[e("button",{onClick:ne,class:d(["page-btn",{disabled:r.value===1}]),disabled:r.value===1},n(s.value?"السابق":"Previous"),11,ot),e("span",nt,n(s.value?`صفحة ${r.value} من ${m.value}`:`Page ${r.value} of ${m.value}`),1),e("button",{onClick:oe,class:d(["page-btn",{disabled:r.value>=m.value}]),disabled:r.value>=m.value},n(s.value?"التالي":"Next"),11,lt)]),I.value?(u(),i("div",{key:3,class:"modal-overlay",onClick:P},[e("div",{class:d(["modal-container",{"dark-mode":f.value}]),onClick:t[2]||(t[2]=Q(()=>{},["stop"]))},[e("div",ct,[e("h2",null,n(B.value),1),e("button",{class:"close-modal",onClick:P},"×")]),e("div",rt,[e("p",null,n(E.value),1),h.value==="reject"?(u(),i("div",it,[e("label",ut,n(s.value?"سبب الرفض:":"Rejection Reason:"),1),G(e("textarea",{id:"rejection-reason","onUpdate:modelValue":t[1]||(t[1]=o=>y.value=o),placeholder:s.value?"يرجى ذكر سبب الرفض...":"Please provide a reason for rejection...",class:"reason-textarea",rows:"3"},null,8,dt),[[z,y.value]]),V.value?(u(),i("p",vt,n(s.value?"سبب الرفض مطلوب":"Rejection reason is required"),1)):p("",!0)])):p("",!0)]),e("div",pt,[e("button",{class:"btn-secondary",onClick:P},n(s.value?"إلغاء":"Cancel"),1),e("button",{class:d(h.value==="approve"?"btn-approve":"btn-reject"),onClick:de,disabled:j.value},n(j.value?s.value?"جاري المعالجة...":"Processing...":h.value==="approve"?s.value?"موافقة":"Approve":s.value?"رفض":"Reject"),11,_t)])],2)])):p("",!0),R.value?(u(),i("div",{key:4,class:"modal-overlay",onClick:F},[e("div",{class:d(["modal-container error-modal",{"dark-mode":f.value}]),onClick:t[3]||(t[3]=Q(()=>{},["stop"]))},[e("div",ht,[e("h2",null,n(s.value?"خطأ":"Error"),1),e("button",{class:"close-modal",onClick:F},"×")]),e("div",ft,[e("p",null,n(D.value),1)]),e("div",bt,[e("button",{class:"btn-secondary",onClick:F},n(s.value?"إغلاق":"Close"),1)])],2)])):p("",!0)],2))}}),jt=ke(gt,[["__scopeId","data-v-344263e5"]]);export{jt as default};
