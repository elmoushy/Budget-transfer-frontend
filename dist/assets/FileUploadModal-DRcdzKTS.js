import{_ as D,r as p,e as n,s as c,h as k,f as s,t as o,p as d,n as y,i as F,F as I}from"./index-Dm8_8feR.js";import{t as S}from"./TransferService-CK9pF5LQ.js";const z={class:"file-modal-header"},T={class:"file-modal-body"},U={key:0,class:"selected-file-info"},N={class:"file-details"},V={class:"file-name"},$={class:"file-size"},P={key:1,class:"upload-placeholder"},L={class:"browse-text"},X={class:"file-format-note"},G={class:"upload-actions"},K=["disabled"],O={key:0,class:"upload-spinner"},j={key:1,class:"btn-icon"},q={class:"status-icon"},H={class:"status-message"},J={__name:"FileUploadModal",props:{show:Boolean,isArabic:Boolean,transactionId:Number,authToken:String},emits:["close","upload-success"],setup(i,{emit:_}){const u=i,x=_,b=p(null),a=p(null),f=p(!1),r=p(!1),t=p({type:"",message:""}),g=()=>{x("close")},E=()=>{a.value||b.value.click()},A=l=>{const e=l.target.files[0];e&&h(e)?(a.value=e,t.value={type:"",message:""}):e&&(t.value={type:"error",message:u.isArabic?"يرجى تحديد ملف Excel صالح (.xlsx, .xls)":"Please select a valid Excel file (.xlsx, .xls)"}),l.target.value=""},C=l=>{f.value=!1;const e=l.dataTransfer.files[0];e&&h(e)?(a.value=e,t.value={type:"",message:""}):e&&(t.value={type:"error",message:u.isArabic?"يرجى تحديد ملف Excel صالح (.xlsx, .xls)":"Please select a valid Excel file (.xlsx, .xls)"})},h=l=>{const e=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],v=[".xlsx",".xls"],m=l.name.toLowerCase().substring(l.name.lastIndexOf("."));return e.includes(l.type)||v.includes(m)},B=l=>{if(l===0)return"0 Bytes";const e=1024,v=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,m)).toFixed(2))+" "+v[m]},M=()=>{a.value=null,t.value={type:"",message:""}},w=async()=>{if(!(!a.value||r.value)){r.value=!0,t.value={type:"",message:""};try{await S.uploadExcelFile(a.value,u.transactionId),t.value={type:"success",message:u.isArabic?`تم رفع الملف بنجاح: ${a.value.name}`:`File uploaded successfully: ${a.value.name}`},x("upload-success"),x("close")}catch(l){console.error("Error uploading file:",l),t.value={type:"error",message:u.isArabic?"فشل في رفع الملف. يرجى التحقق من تنسيق الملف والمحاولة مرة أخرى.":"Failed to upload file. Please check file format and try again."}}finally{r.value=!1}}};return(l,e)=>(c(),n(I,null,[i.show?(c(),n("div",{key:0,class:"file-modal-overlay",onClick:g},[s("div",{class:"file-modal-content",onClick:e[3]||(e[3]=d(()=>{},["stop"]))},[s("div",z,[s("h3",null,o(i.isArabic?"رفع ملف المناقلة":"Upload Transfer File"),1),s("button",{class:"file-modal-close",onClick:g},"×")]),s("div",T,[s("div",{class:y(["file-upload-area",{"drag-active":f.value,"has-file":a.value}]),onClick:E,onDrop:d(C,["prevent"]),onDragover:e[0]||(e[0]=d(()=>{},["prevent"])),onDragenter:e[1]||(e[1]=d(v=>f.value=!0,["prevent"])),onDragleave:e[2]||(e[2]=d(v=>f.value=!1,["prevent"]))},[a.value?(c(),n("div",U,[e[4]||(e[4]=s("div",{class:"file-icon"},[s("span",{class:"file-icon-text"},"XLSX")],-1)),s("div",N,[s("span",V,o(a.value.name),1),s("span",$,o(B(a.value.size)),1)]),s("button",{class:"remove-file-btn",onClick:d(M,["stop"])},"×")])):(c(),n("div",P,[e[5]||(e[5]=s("div",{class:"upload-icon"},"↑",-1)),s("p",null,[F(o(i.isArabic?"اسحب وأفلت ملف Excel أو":"Drag & drop Excel file or")+" ",1),s("span",L,o(i.isArabic?"تصفح":"browse"),1)]),s("p",X,o(i.isArabic?"ملفات Excel (.xlsx, .xls) فقط":"Excel files (.xlsx, .xls) only"),1)]))],34),s("div",G,[s("button",{class:y(["btn-file-upload",{"btn-disabled":!a.value||r.value}]),onClick:w,disabled:!a.value||r.value},[r.value?(c(),n("span",O)):(c(),n("span",j,"↑")),F(" "+o(i.isArabic?"رفع الملف":"Upload File"),1)],10,K),s("button",{class:"btn-file-cancel",onClick:g},o(i.isArabic?"إلغاء":"Cancel"),1)]),t.value.message?(c(),n("div",{key:0,class:y(["upload-status",t.value.type])},[s("span",q,o(t.value.type==="success"?"✓":"!"),1),s("span",H,o(t.value.message),1)],2)):k("",!0)])])])):k("",!0),s("input",{type:"file",ref_key:"fileInput",ref:b,class:"hidden-file-input",onChange:A,accept:".xlsx,.xls"},null,544)],64))}},W=D(J,[["__scopeId","data-v-ed75eea4"]]);export{W as F};
